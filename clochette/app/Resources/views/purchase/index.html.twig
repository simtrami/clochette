{% extends 'base.html.twig' %}

{% block title %}Achat{% endblock %}

{% block stylesheet %}
    <link rel="stylesheet" href="{{ asset('css/caisse.css') }}">
{% endblock %}

{% block javascripts %}
<Script>
$(".btn-value").on("click", function() {

    var button = $(this);
    var qte = button.parent().parent().find(".qte");
    var oldValue = button.parent().parent().find("input").val();

    if (button.text() == "+") {
        var newVal = parseFloat(oldValue) + 1;
        console.log(newVal);
    } else {
    // Don't allow decrementing below zero
        if (oldValue > 0) {
            var newVal = parseFloat(oldValue) - 1;
            console.log(newVal);
        } else {
            newVal = 0;
        }
    }

    button.parent().parent().find(".qte").attr("value", newVal);
    button.parent().parent().find(".qte").val(newVal);
    console.log(button.parent().parent().find(".qte").val());

    var tot = 0;
    $(".qte").each(function() {
        var prix = $(this).parent().parent().find("#prix").val();
        tot = tot + parseFloat($(this).val()) * parseFloat(prix);
    });
    $("#total").attr("value", tot);
});

$(".qte").on("input", function() {

    var tot = 0;
    $(".qte").each(function() {
        var prix = $(this).parent().parent().find("#prix").val();
        tot = tot + parseFloat($(this).val()) * parseFloat(prix);
    });
    $("#total").attr("value", tot);
});

</script>
{% endblock %}

{% block body %}
<div class="container-fluid">
    <h5>Pressions:</h5>
    <div class="row affichage-articles">
        {% for article in drafts_notnull %}
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-3 pad-b">
                <div class="card article" style="width: 18rem;">
                    <div class="card-body">
                        <label for="inputPrixAchat"></label>
                        <h5 class="card-title center">{{ article.nom }}</h5>
                        <div class="input-group">
                            <input value="{{ article.prixVente }}" type="text"
                                class="form-control" id="prix" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="inputGroupAppend"><i class="fa fa-euro-sign"></i></span>
                            </div>
                        </div>{# 
                        <h5 class="card-title center">{{ article.nom }}</h5>
                        <p class="card-text center">{{ article.prixVente }}€</p> #}

                        <div class="row col-8 align-items-center add-delete-article ">
                            <label for="exampleFormControlInput1">Quantité</label>
                            <input type="text"class="qte" autocomplete="" value="0">
                            <div class="pad-r">
                                <a class="btn btn-outline-danger btn-value" id="moins">-</a>
                            </div>
                            <div class="pad-r">
                                <a class=" btn btn-outline-success btn-value" id="plus">+</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <h5>Bouteilles:</h5>
    <div class="row affichage-articles">
        {% for article in bottles_notnull %}
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-3 pad-b">
                <div class="card article" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title center">{{ article.nom }}</h5>
                        <div class="input-group">
                            <input value="{{ article.prixVente }}" type="text"
                                class="form-control" id="prix" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="inputGroupAppend"><i class="fa fa-euro-sign"></i></span>
                            </div>
                        </div>

                        <div class="row col-8 align-items-center add-delete-article ">
                            <label for="exampleFormControlInput1">Quantité</label>
                            <input type="text"class="qte" autocomplete="" value="0">
                            <div class="pad-r">
                                <a class="btn btn-outline-danger btn-value" id="moins">-</a>
                            </div>
                            <div class="pad-r">
                                <a class=" btn btn-outline-success btn-value" id="plus">+</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <h5>Autres:</h5>
    <div class="row affichage-articles">
        {% for article in article_notnull %}
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-3 pad-b">
                <div class="card article" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title center">{{ article.nom }}</h5>
                        <div class="input-group">
                            <input value="{{ article.prixVente }}" type="text"
                                class="form-control" id="prix" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="inputGroupAppend"><i class="fa fa-euro-sign"></i></span>
                            </div>
                        </div>

                        <div class="row col-8 align-items-center add-delete-article ">
                            <label for="exampleFormControlInput1" >Quantité</label>
                            <input type="text"class="qte" autocomplete="" value="0">
                            <div class="pad-r">
                                <a class="btn btn-outline-danger btn-value" id="moins">-</a>
                            </div>
                            <div class="pad-r">
                                <a class=" btn btn-outline-success btn-value" id="plus">+</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>


    <div class="row ">

        <div class="list-articles">
            <p>
                <a class="btn btn-success" data-toggle="collapse" href="#collapseExample" role="button"
                   aria-expanded="false" aria-controls="collapseExample">
                    Listes Articles
                </a>
            </p>


            <div class="collapse" id="collapseExample">
                <div class="card card-body">
                    {% if articlesPanier is defined %}
                        {% for articlePanier in articlesPanier %}
                            {{ articlePanier.nom }} : {{ articlePanier.id }} </br>
                        {% endfor %}
                    {% else %}
                        {% set articlesPanier = [] %}
                    {% endif %}

                    <!-- Script à refaire (EDIT: c fé fo testé)
                    <?php
                    if (!empty($articlesPanier)) {
                        foreach ($articlesPanier as $articlePanier) {
                            echo $articlePanier->nom . ' : ' . $_SESSION['panier'] [$articlePanier->id] . '<br>';
                        }
                    } else {
                        $articlesPanier = array();
                    }

                    ?> -->
                </div>
            </div>
        </div>


        <div class="cancel-command">
            <button type="button" class="btn btn-danger">
                <a href="index.php?rooting=caisse&panier=reset">Annuler Commande</a></button>
        </div>


        <div class="input-group">

            <div class="input-group-append">
                <input type="text" id="total" value="0">
                <span class="input-group-text">€</span>

            </div>
        </div>

        <div class="payer">
            <form action="index.php?rooting=caisse&panier=reset" method="get">
                <button type="button" class="btn btn-success">
                    <a href="index.php?rooting=caisse&panier=reset">Payer</a>
                </button>
            </form>
        </div>
    </div>
</div>



    <div class="afficheArticle">
        
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Heineken 25cl                </div>
                <div class="box-article-prix">
                    3€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Biere                </div>
                <div class="box-article-prix">
                    12€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Kro                </div>
                <div class="box-article-prix">
                    2€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Delirium Red                </div>
                <div class="box-article-prix">
                    8€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Shooter                </div>
                <div class="box-article-prix">
                    2€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Chouffe                </div>
                <div class="box-article-prix">
                    12€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Coca                </div>
                <div class="box-article-prix">
                    2€                </div>

            </div>
            
            <div class="box-article">
                <div class="box-article-nom" id="<? php echo $donnees['id'];?>">
                    Voiture                </div>
                <div class="box-article-prix">
                    15€                </div>

            </div>
            
    </div>

    <div class="caisse">
        <div class="prix">Prix : <input value="0">€</div>
        <button>Valider</button>
    </div>
{% endblock %}